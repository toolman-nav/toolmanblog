---
import { siteConfig, profileConfig } from '@/config';

interface Props {
  title: string;
  description: string;
  pubDate: Date | string; // å…¼å®¹å­—ç¬¦ä¸²å’Œæ—¥æœŸå¯¹è±¡
  updatedDate?: Date | string;
  heroImage?: string;
}

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;

// ğŸ› ï¸ è¾…åŠ©å‡½æ•°ï¼šå¼ºåˆ¶è½¬æ¢ä¸º ISO 8601 æ ¼å¼ (å¸¦æ—¶åŒº)
function toISODateString(dateInput: Date | string | undefined) {
  if (!dateInput) return new Date().toISOString();
  const date = new Date(dateInput);
  return date.toISOString(); // è¾“å‡ºä¾‹å¦‚ï¼š2023-10-01T00:00:00.000Z
}

// ğŸ–¼ï¸ å›¾ç‰‡é€»è¾‘ï¼šå¦‚æœæœ‰æ–‡ç« å›¾ç”¨æ–‡ç« å›¾ï¼Œæ²¡æœ‰åˆ™ç”¨ç½‘ç«™é»˜è®¤å¤´åƒ/Logo
const schemaImage = heroImage 
  ? new URL(heroImage, Astro.site).toString() 
  : new URL(profileConfig.avatar || "/favicon.png", Astro.site).toString();

const schema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": title,
  "description": description,
  "image": schemaImage, // ğŸ‘ˆ ä¿®å¤äº† missing image
  "datePublished": toISODateString(pubDate), // ğŸ‘ˆ ä¿®å¤äº†æ—¥æœŸæ ¼å¼
  "dateModified": toISODateString(updatedDate || pubDate),
  "author": {
    "@type": "Person",
    "name": profileConfig.name,
    "url": Astro.site
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": Astro.url
  }
};
---

<script type="application/ld+json" set:html={JSON.stringify(schema)} />